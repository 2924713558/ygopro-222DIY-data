language: cpp
dist: trusty
git:
  submodules: false
addons:
  ssh_known_hosts:
  - github.com
  apt:
    packages:
    - libevent-dev
    - libsqlite3-dev
    - sqlite3

before_install:

- git config --global user.name purerosefallen
- git config --global user.email 78877@qq.com

- git clone --depth=1 --branch=server --recursive https://github.com/purerosefallen/ygopro
- cd ygopro

- git submodule foreach git checkout master
- ln -s ./../expansions .

- wget -O - https://github.com/premake/premake-core/releases/download/v5.0.0-alpha12/premake-5.0.0-alpha12-linux.tar.gz | tar zfx -
- wget -O - https://www.lua.org/ftp/lua-5.3.4.tar.gz | tar zfx -; cd lua-5.3.4; sudo make linux install; cd ..
- ./premake5 gmake
- cd build
- make config=release

- cd ..
- mv -f ./bin/release/ygopro .
- strip ygopro
- mkdir replay

script:
- echo \"select id from datas;\" | sqlite3 ./expansions/222DIY.cdb | xargs -I {} ./ygopro {} 2>&1 | tee ../redtext.txt
- cd ..

- echo "Redtext check with commit $TRAVIS_COMMIT \"$TRAVIS_COMMIT_MESSAGE\" on $(date +%m.%d)." >> ./redtext.txt
- git add ./redtext.txt
- git commit -m "test redtext of $TRAVIS_COMMIT"
- git push -f https://$NANAHIRA@github.com/purerosefallen/ygopro-222DIY-data HEAD:redtext

branches:
  only:
  - master
